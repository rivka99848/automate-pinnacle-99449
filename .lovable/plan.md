
# תוכנית מקיפה: מערכת ניהול חבילות פניות

## סקירת המצב הנוכחי

כרגע כל משתמש יכול לשלוח פניה ללא הגבלה - אין בדיקה של חבילה פעילה.

## הזרימה החדשה

```text
+------------------+     +------------------+     +------------------+
|  משתמש מזין     | --> | בדיקת חבילה      | --> | יש חבילה פעילה?  |
|  אימייל         |     | webhook support3 |     |                  |
+------------------+     +------------------+     +--------+---------+
                                                          |
                         +--------------------------------+
                         |                                |
                    כן (יש פניות)                   לא (אין חבילה/נגמרו)
                         |                                |
                         v                                v
              +------------------+              +------------------+
              | הצג טופס פנייה  |              | הצג הודעה +      |
              | + מספר פניות    |              | כפתור רכישה     |
              | שנותרו         |              +------------------+
              +------------------+                       |
                         |                               v
                         v                    +------------------+
              +------------------+            | הפניה לדף תשלום |
              | שליחת פנייה    |            | pay.sumit.co.il  |
              | webhook support1 |            +------------------+
              +------------------+
```

## שינויים נדרשים

### 1. דף "הפניות שלי" (SupportMyTickets.tsx)

**תוספות:**
- כפתור "רכישת חבילת פניות" בראש הדף (תמיד מוצג)
- לאחר חיפוש - הצגת מצב החבילה:
  - כמה פניות נותרו
  - סטטוס החבילה (פעילה/לא פעילה)
- אם אין חבילה פעילה - הודעה ברורה עם כפתור רכישה

**קריאה חדשה:**
- Webhook `support3` עם האימייל
- תגובה צפויה: `{ active: true/false, remaining: 5, total: 10 }`

### 2. דף "פתיחת פנייה" (SupportCreate.tsx)

**שינוי הזרימה:**

**שלב א - הזנת אימייל:**
- המשתמש מזין אימייל
- כפתור "בדיקת חבילה"

**שלב ב - בדיקה (webhook support3):**
- טעינה עם spinner
- בדיקה האם יש חבילה פעילה עם פניות זמינות

**שלב ג - תוצאות:**

אם יש חבילה פעילה:
- הצגת "נותרו לך X פניות מתוך Y"
- הצגת טופס הפנייה המלא
- אפשרות לשלוח

אם אין חבילה/נגמרו הפניות:
- הודעה ברורה: "אין לך חבילת פניות פעילה" או "נגמרו הפניות בחבילה"
- כפתור בולט "רכישת חבילת פניות"
- לחיצה → פתיחה בחלון חדש לדף התשלום
- קישור "כבר רכשת? לחצי לבדיקה מחדש"

### 3. רכיב חדש: PackageStatus

רכיב לתצוגת מצב חבילה שיופיע בשני הדפים:
- אייקון וצבע לפי מצב (ירוק/צהוב/אדום)
- מספר פניות שנותרו
- כפתור רכישה אם צריך

### 4. רכיב חדש: NoPackageMessage

הודעה מעוצבת שמוצגת כשאין חבילה:
- אייקון אזהרה
- טקסט הסבר
- כפתור רכישה בולט
- עיצוב מושך תשומת לב

## מבנה התגובה הצפוי מ-support3

```json
{
  "has_package": true,
  "package_status": "active",
  "remaining_tickets": 5,
  "total_tickets": 10,
  "package_name": "חבילה בסיסית",
  "expires_at": "2025-03-01"
}
```

או אם אין חבילה:
```json
{
  "has_package": false,
  "message": "לא נמצאה חבילה פעילה"
}
```

## קישור התשלום

```
https://pay.sumit.co.il/6ir0yg/mh9r7w/mh9r7x/payment/
```

## פרטים טכניים

### קבצים לעריכה:
1. `src/pages/SupportCreate.tsx` - שינוי מהותי בזרימה
2. `src/pages/SupportMyTickets.tsx` - הוספת כפתור ומצב חבילה

### קבצים חדשים:
1. `src/components/support/PackageStatus.tsx` - רכיב תצוגת מצב
2. `src/components/support/NoPackageMessage.tsx` - הודעה ללא חבילה

### States חדשים ב-SupportCreate:
```typescript
const [packageStatus, setPackageStatus] = useState<PackageInfo | null>(null);
const [isCheckingPackage, setIsCheckingPackage] = useState(false);
const [packageChecked, setPackageChecked] = useState(false);
```

### Interface חדש:
```typescript
interface PackageInfo {
  has_package: boolean;
  package_status?: string;
  remaining_tickets?: number;
  total_tickets?: number;
  package_name?: string;
  expires_at?: string;
  message?: string;
}
```

## חוויית משתמש

1. משתמש נכנס לדף פתיחת פנייה
2. מזין אימייל ולוחץ "בדיקת חבילה"
3. רואה ספינר בזמן הבדיקה
4. אם יש חבילה - רואה כמה פניות נשארו והטופס מופיע
5. אם אין - רואה הודעה ברורה וכפתור רכישה
6. לאחר רכישה - יכול לחזור ולבדוק שוב
